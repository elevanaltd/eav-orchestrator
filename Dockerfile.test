# Hermetic test environment - CI parity enforced
# Critical-Engineer: consulted for Hermetic test environment strategy
FROM node:22.2.0-alpine3.19

LABEL maintainer="eav-orchestrator-team"
LABEL purpose="hermetic-test-environment"

WORKDIR /app

# Install dependencies as root
COPY package*.json ./
RUN npm ci

# Copy application code
COPY . .

# Create non-root user and give ownership of app directory
RUN addgroup -S appgroup && adduser -S appuser -G appgroup && \
    chown -R appuser:appgroup /app

# Switch to non-root user
USER appuser

# Set default command to run tests
CMD ["npm", "test"]
